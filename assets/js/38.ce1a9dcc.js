(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{430:function(e,t,r){"use strict";r.r(t);var l=r(56),i=Object(l.a)({},(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[r("h1",{attrs:{id:"学习使用docker实战betterlife"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#学习使用docker实战betterlife"}},[e._v("#")]),e._v(" 学习使用Docker实战betterlife")]),e._v(" "),r("h2",{attrs:{id:"docker-多阶段构建betterlife"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#docker-多阶段构建betterlife"}},[e._v("#")]),e._v(" Docker 多阶段构建betterlife")]),e._v(" "),r("p",[e._v("本方式可供学习Docker多阶段构建使用。")]),e._v(" "),r("h3",{attrs:{id:"参考"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[e._v("#")]),e._v(" 参考")]),e._v(" "),r("ul",[r("li",[r("a",{attrs:{href:"https://yeasy.gitbook.io/docker_practice/image/multistage-builds/laravel",target:"_blank",rel:"noopener noreferrer"}},[e._v("实战多阶段构建 Laravel 镜像"),r("OutboundLink")],1)]),e._v(" "),r("li",[r("a",{attrs:{href:"https://github.com/khs1994-docker/laravel-demo/blob/master/Dockerfile",target:"_blank",rel:"noopener noreferrer"}},[e._v("laravel-demo/Dockerfile"),r("OutboundLink")],1)])]),e._v(" "),r("h3",{attrs:{id:"具体操作"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#具体操作"}},[e._v("#")]),e._v(" 具体操作")]),e._v(" "),r("p",[e._v("以下操作均在根路径下命令行中执行:")]),e._v(" "),r("ul",[r("li",[r("p",[e._v("创建镜像和互通的网络")]),e._v(" "),r("ul",[r("li",[e._v("docker build -t bb/betterlife --target=betterlife -f install/docker/Dockerfile .")]),e._v(" "),r("li",[e._v("docker build -t bb/nginx --target=nginx -f install/docker/Dockerfile .")]),e._v(" "),r("li",[e._v("docker network create betterlife")]),e._v(" "),r("li",[e._v("docker volume create betterlife_ueditor")]),e._v(" "),r("li",[e._v("docker volume create betterlife_composer")])])]),e._v(" "),r("li",[r("p",[e._v("运行容器应用")]),e._v(" "),r("ul",[r("li",[r("p",[e._v("docker run -dit --name=betterlife -p 9000:9000 -v "),r("code",[e._v("pwd")]),e._v(":/var/www/html/betterlife -v betterlife_composer:/var/www/html/betterlife/install/vendor -v betterlife_ueditor:/var/www/html/betterlife/misc/js/onlineditor/ueditor --network=betterlife bb/betterlife")])]),e._v(" "),r("li",[r("p",[e._v("docker run -dit --name=betterlife_nginx -v "),r("code",[e._v("pwd")]),e._v(":/var/www/html/betterlife  -v betterlife_composer:/var/www/html/betterlife/install/vendor -v betterlife_ueditor:/var/www/html/betterlife/misc/js/onlineditor/ueditor -p 80:80 --network=betterlife bb/nginx")])]),e._v(" "),r("li",[r("p",[e._v("[说明]:")]),e._v(" "),r("ul",[r("li",[e._v("本地物理机Web路径: "),r("code",[e._v("pwd")])]),e._v(" "),r("li",[e._v("容器里Web放置路径: /var/www/html/betterlife")]),e._v(" "),r("li",[e._v("如果使用如阿里云其他外网的Mysql数据库，提供域名或者外网地址；只需修改Gc.php里相应的数据库配置即可")])])])])]),e._v(" "),r("li",[r("p",[e._v("停止应用     : docker stop betterlife betterlife_nginx")])]),e._v(" "),r("li",[r("p",[e._v("删除所有的容器: docker rm betterlife betterlife_nginx")])]),e._v(" "),r("li",[r("p",[e._v("删除生成的镜像: docker rmi bb/nginx bb/betterlife")])])]),e._v(" "),r("h2",{attrs:{id:"上传到docker-hub"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#上传到docker-hub"}},[e._v("#")]),e._v(" 上传到Docker Hub")]),e._v(" "),r("h3",{attrs:{id:"lemp"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#lemp"}},[e._v("#")]),e._v(" Lemp")]),e._v(" "),r("h4",{attrs:{id:"运行镜像"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#运行镜像"}},[e._v("#")]),e._v(" 运行镜像")]),e._v(" "),r("ul",[r("li",[r("p",[e._v("从Docker Hub下载运行betterlife框架。")]),e._v(" "),r("ul",[r("li",[r("p",[e._v("Docker Hub上查询镜像: https://hub.docker.com  -> 搜索:  skygreen2021/betterlife")])]),e._v(" "),r("li",[r("p",[e._v("运行betterlife框架: docker run -dp 80:80 --name betterlife -t skygreen2021/betterlife")])]),e._v(" "),r("li",[r("p",[e._v("容器运行成功后安装运行示例数据库: docker exec -it betterlife bash -c 'mysql betterlife < /var/www/install/db/mysql/db_betterlife.sql'")])]),e._v(" "),r("li",[r("p",[e._v("运行脚本汇总如下")])])]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("  docker run -dp 80:80 --name betterlife -t skygreen2021/betterlife\n  docker exec -it betterlife bash -c 'mysql betterlife < /var/www/install/db/mysql/db_betterlife.sql'\n")])])])]),e._v(" "),r("li",[r("p",[e._v("开放数据库接口，本地可操作: docker run -dp 80:80 -p 3306:3306 --name betterlife -t skygreen2021/betterlife")])]),e._v(" "),r("li",[r("p",[e._v("其它docker run配置参数参考: "),r("a",{attrs:{href:"https://hub.docker.com/r/novice/lemp",target:"_blank",rel:"noopener noreferrer"}},[e._v("novice/lemp"),r("OutboundLink")],1)])]),e._v(" "),r("li",[r("p",[e._v("体验后删除betterlife框架")]),e._v(" "),r("ul",[r("li",[e._v("删除betterlife框架容器及镜像: docker stop betterlife && docker rm betterlife && docker rmi skygreen2021/betterlife")])])])]),e._v(" "),r("h4",{attrs:{id:"创建镜像"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#创建镜像"}},[e._v("#")]),e._v(" 创建镜像")]),e._v(" "),r("ul",[r("li",[e._v("制作[ skygreen2001/betterlife ]镜像提交到Docker Hub\n"),r("ul",[r("li",[r("p",[e._v("只需要制作一个镜像，betterlife框架和apache服务器使用一个镜像。")])]),e._v(" "),r("li",[r("p",[e._v("本功能用于制作演示betterlife框架的 Docker镜像，提交到Docker Hub，公开对外的Dockerfile文件及环境搭建。")])]),e._v(" "),r("li",[r("p",[e._v("创建betterlife镜像提交到Docker Hub")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("  docker build -t betterlife --target=betterlife -f install/docker/hub/lemp/Dockerfile .\n  docker tag betterlife skygreen2021/betterlife\n  docker login -u [YOUR-USER-NAME]\n  docker push skygreen2021/betterlife\n")])])]),r("ul",[r("li",[e._v("hub上查询提交的镜像: https://hub.docker.com  -> 搜索:  skygreen2021/betterlife")]),e._v(" "),r("li",[e._v("如果本地已经存在，需要更新镜像: docker pull skygreen2021/betterlife")]),e._v(" "),r("li",[e._v("运行推送的hub: docker run -dp 80:80 --name betterlife skygreen2021/betterlife")])])])])])]),e._v(" "),r("h3",{attrs:{id:"apache"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#apache"}},[e._v("#")]),e._v(" Apache")]),e._v(" "),r("h4",{attrs:{id:"运行镜像-2"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#运行镜像-2"}},[e._v("#")]),e._v(" 运行镜像")]),e._v(" "),r("ul",[r("li",[r("p",[e._v("从Docker Hub下载运行betterlife框架。")]),e._v(" "),r("ul",[r("li",[r("p",[e._v("Docker Hub上查询镜像: https://hub.docker.com  -> 搜索:  skygreen2021/bb_apache")])]),e._v(" "),r("li",[r("p",[e._v("在工作目录下创建betterlife目录并进入: mkdir betterlife && cd betterlife")])]),e._v(" "),r("li",[r("p",[e._v("创建网络: docker network create betterlife")])]),e._v(" "),r("li",[r("p",[e._v("运行betterlife框架: docker run -dit --name=bb_apache -p 80:80 --network=betterlife skygreen2021/bb_apache")])]),e._v(" "),r("li",[r("p",[e._v("本地创建所需示例数据库脚本所在路径: mkdir -p install/db")])]),e._v(" "),r("li",[r("p",[e._v("从容器里复制示例数据库脚本文件到本地: docker cp bb_apache:/var/www/html/install/db/mysql $(pwd)/install/db")])]),e._v(" "),r("li",[r("p",[e._v("运行示例数据库: docker run -itd --name mysql -p 3306:3306 -v "),r("code",[e._v("pwd")]),e._v("/install/db/mysql:/docker-entrypoint-initdb.d/ -v mysql-data:/var/lib/mysql -e MYSQL_ALLOW_EMPTY_PASSWORD=root -e MYSQL_ROOT_PASSWORD= -e MYSQL_DATABASE=betterlife --network=betterlife mysql")])]),e._v(" "),r("li",[r("p",[e._v("运行脚本汇总如下")])])]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("  mkdir betterlife && cd betterlife\n  docker network create betterlife\n  docker run -dit --name=bb_apache -p 80:80 --network=betterlife skygreen2021/bb_apache\n  mkdir -p install/db\n  docker cp bb_apache:/var/www/html/install/db/mysql $(pwd)/install/db\n  docker run -itd --name mysql -p 3306:3306 -v `pwd`/install/db/mysql:/docker-entrypoint-initdb.d/ -v mysql-data:/var/lib/mysql -e MYSQL_ALLOW_EMPTY_PASSWORD=root -e MYSQL_ROOT_PASSWORD= -e MYSQL_DATABASE=betterlife --network=betterlife mysql\n")])])])]),e._v(" "),r("li",[r("p",[e._v("体验后删除betterlife框架")]),e._v(" "),r("ul",[r("li",[e._v("删除betterlife框架容器及镜像: docker stop bb_apache && docker rm bb_apache && docker rmi skygreen2021/bb_apache")]),e._v(" "),r("li",[e._v("删除示例数据库容器及镜像     : docker stop mysql && docker rm mysql && docker rmi mysql")])])])]),e._v(" "),r("h4",{attrs:{id:"创建镜像-2"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#创建镜像-2"}},[e._v("#")]),e._v(" 创建镜像")]),e._v(" "),r("ul",[r("li",[e._v("制作[ skygreen2001/bb_apache ]镜像提交到Docker Hub\n"),r("ul",[r("li",[r("p",[e._v("只需要制作一个镜像，betterlife框架和apache服务器使用一个镜像。")])]),e._v(" "),r("li",[r("p",[e._v("本功能用于制作演示betterlife框架的 Docker镜像，提交到Docker Hub，公开对外的Dockerfile文件及环境搭建。")])]),e._v(" "),r("li",[r("p",[e._v("在容器内运行还需修改Gc.php文件相应配置")]),e._v(" "),r("ul",[r("li",[e._v("数据库配置: $database_config\n"),r("ul",[r("li",[e._v('$database_config -> host = "mysql"\n'),r("ul",[r("li",[e._v("数据库的主机需配置为mysql，这是因为容器mysql服务器的容器名称定义就是mysql，这样php才能连上数据库。")])])])])])])]),e._v(" "),r("li",[r("p",[e._v("创建bb_apache镜像提交到Docker Hub")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("  docker build -t bb_apache --target=betterlife -f install/docker/hub/apache/Dockerfile .\n  docker tag bb_apache skygreen2021/bb_apache\n  docker login -u [YOUR-USER-NAME]\n  docker push skygreen2021/bb_apache\n")])])]),r("ul",[r("li",[e._v("hub上查询提交的镜像: https://hub.docker.com  -> 搜索:  skygreen2021/bb_apache")]),e._v(" "),r("li",[e._v("如果本地已经存在，需要更新镜像: docker pull skygreen2021/bb_apache")]),e._v(" "),r("li",[e._v("运行推送的hub: docker run -dp 80:80 skygreen2021/bb_apache")])])])])])]),e._v(" "),r("h3",{attrs:{id:"nginx"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#nginx"}},[e._v("#")]),e._v(" Nginx")]),e._v(" "),r("h4",{attrs:{id:"运行镜像-3"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#运行镜像-3"}},[e._v("#")]),e._v(" 运行镜像")]),e._v(" "),r("ul",[r("li",[r("p",[e._v("从Docker Hub拉取bb, bb_nginx镜像并运行")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("  docker run -ti --rm -v ${HOME}:/root -v $(pwd):/git alpine/git clone https://github.com/skygreen2001/betterlife\n\n  cd betterlife/\n\n  docker network create betterlife\n  \n  docker run -itd --name mysql -p 3306:3306 -v `pwd`/install/db/mysql:/docker-entrypoint-initdb.d/ -v mysql-data:/var/lib/mysql -e MYSQL_ALLOW_EMPTY_PASSWORD=root -e MYSQL_ROOT_PASSWORD= -e MYSQL_DATABASE=betterlife --network=betterlife mysql\n\n  docker run -dit --name=bb -p 9000:9000 -v `pwd`:/var/www/html/betterlife -v betterlife_composer:/var/www/html/betterlife/install/vendor -v betterlife_ueditor:/var/www/html/betterlife/misc/js/onlineditor/ueditor --network=betterlife skygreen2021/bb\n\n  docker run -dit --name=bb_nginx -p 80:80 -v `pwd`:/var/www/html/betterlife  -v betterlife_composer:/var/www/html/betterlife/install/vendor -v betterlife_ueditor:/var/www/html/betterlife/misc/js/onlineditor/ueditor --network=betterlife skygreen2021/bb_nginx\n")])])])]),e._v(" "),r("li",[r("p",[e._v("可在本地编辑php源文件，所见即所得，会立即在容器内生效运行生成结果。")])]),e._v(" "),r("li",[r("p",[e._v("在容器内运行还需修改Gc.php文件相应配置")]),e._v(" "),r("ul",[r("li",[e._v("数据库配置: $database_config\n"),r("ul",[r("li",[e._v('$database_config -> host = "mysql"\n'),r("ul",[r("li",[e._v("数据库的主机需配置为mysql，这是因为容器mysql服务器的容器名称定义就是mysql，这样php才能连上数据库。")])])])])]),e._v(" "),r("li",[e._v("网站路径配置: $url_base\n"),r("ul",[r("li",[e._v("网站路径默认是不配置的，通过算法得到，但是在docker容器内，需要手动配置")]),e._v(" "),r("li",[e._v("生产服务器上需配置域名")]),e._v(" "),r("li",[e._v('本地配置一般是: $url_base="http://localhost/"; 或者 $url_base="http://127.0.0.1/";')])])])])]),e._v(" "),r("li",[r("p",[e._v("体验后删除betterlife框架")]),e._v(" "),r("ul",[r("li",[e._v("停止应用     : docker stop bb bb_nginx mysql")]),e._v(" "),r("li",[e._v("删除所有的容器: docker rm bb bb_nginx mysql")]),e._v(" "),r("li",[e._v("删除生成的镜像: docker rmi skygreen2021/bb_nginx skygreen2021/bb mysql")])])])]),e._v(" "),r("h4",{attrs:{id:"创建镜像-3"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#创建镜像-3"}},[e._v("#")]),e._v(" 创建镜像")]),e._v(" "),r("ul",[r("li",[e._v("制作[ skygreen2001/bb, skygreen2001/bb_nginx ]镜像提交到Docker Hub\n"),r("ul",[r("li",[r("p",[e._v("需要制作两个镜像，一个是betterlife框架本身，另一个是nginx服务器，分开运行的两个镜像。")])]),e._v(" "),r("li",[r("p",[e._v("本功能用于制作演示betterlife框架的 Docker镜像，提交到Docker Hub，公开对外的Dockerfile文件及环境搭建。")])]),e._v(" "),r("li",[r("p",[e._v("创建bb, bb_nginx镜像提交到Docker Hub")]),e._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("  docker build -t bb --target=betterlife -f install/docker/Dockerfile .\n  docker build -t bb_nginx --target=nginx -f install/docker/Dockerfile .\n  docker tag bb skygreen2021/bb\n  docker tag bb_nginx skygreen2021/bb_nginx\n  docker login -u [YOUR-USER-NAME]\n  docker push skygreen2021/bb\n  docker push skygreen2021/bb_nginx\n")])])]),r("ul",[r("li",[e._v("hub上查询提交的镜像: https://hub.docker.com  -> 搜索:  skygreen2021/bb")]),e._v(" "),r("li",[e._v("如果本地已经存在，需要更新镜像: docker pull skygreen2021/bb && docker pull skygreen2021/bb_nginx")])])])])])]),e._v(" "),r("h2",{attrs:{id:"使用laradock"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#使用laradock"}},[e._v("#")]),e._v(" 使用Laradock")]),e._v(" "),r("ul",[r("li",[r("a",{attrs:{href:"https://laradock.io/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Laradock"),r("OutboundLink")],1),e._v(" "),r("ul",[r("li",[e._v("修改/etc/hosts\n"),r("ul",[r("li",[e._v("添加一行: 199.232.68.133 raw.githubusercontent.com")])])]),e._v(" "),r("li",[e._v("下载betterlife: git clone https://github.com.cnpmjs.org/skygreen2001/betterlife")]),e._v(" "),r("li",[e._v("下载Laradock  : git clone https://github.com.cnpmjs.org/Laradock/laradock.git")]),e._v(" "),r("li",[e._v("两个项目平级，如下\n"),r("ul",[r("li",[e._v("betterlife")]),e._v(" "),r("li",[e._v("laradock")])])]),e._v(" "),r("li",[e._v("重命名[ .env ]: cp .env.example .env")]),e._v(" "),r("li",[e._v("清空缓存(如果有的话): rm -rf ~/.laradock/data/mysql")]),e._v(" "),r("li",[e._v("在laradock根路径下做以下调整\n"),r("ul",[r("li",[e._v("修改 .env:\n"),r("ul",[r("li",[e._v("CHANGE_SOURCE=true\n"),r("ul",[r("li",[e._v("说明: 使用国内镜像")])])]),e._v(" "),r("li",[e._v("MYSQL_DATABASE=betterlife")]),e._v(" "),r("li",[e._v("MYSQL_ALLOW_EMPTY_PASSWORD=root")]),e._v(" "),r("li",[e._v("MYSQL_ROOT_PASSWORD=")]),e._v(" "),r("li",[e._v("MYSQL_ENTRYPOINT_INITDB=../betterlife/install/db/mysql")]),e._v(" "),r("li",[e._v("WORKSPACE_INSTALL_XDEBUG=true")]),e._v(" "),r("li",[e._v("PHP_FPM_INSTALL_XDEBUG=true")])])]),e._v(" "),r("li",[e._v("修改docker-compose.yml\n"),r("ul",[r("li",[e._v("在mysql: environment: 下添加一行\n"),r("ul",[r("li",[e._v("MYSQL_ALLOW_EMPTY_PASSWORD=${MYSQL_ALLOW_EMPTY_PASSWORD}")])])])])]),e._v(" "),r("li",[e._v("修改nginx/sites/default.conf\n"),r("ul",[r("li",[e._v("修改前: root /var/www/public;")]),e._v(" "),r("li",[e._v("修改后: root /var/www/betterlife;")])])]),e._v(" "),r("li",[e._v("运行容器: docker-compose up -d nginx mysql phpmyadmin redis workspace")])])]),e._v(" "),r("li",[e._v("在betterlife根路径下需做以下操作")]),e._v(" "),r("li",[e._v("在容器内运行还需修改Gc.php文件相应配置\n"),r("ul",[r("li",[e._v("数据库配置: $database_config\n"),r("ul",[r("li",[e._v('$database_config -> host = "mysql"')])])])])]),e._v(" "),r("li",[e._v("安装UEditor\n"),r("ul",[r("li",[r("RouterLink",{attrs:{to:"/core/install/other_install.html"}},[e._v("参考【安装PHP第三方库和UEditor】的安装UEditor部分")])],1)])]),e._v(" "),r("li",[e._v("打开浏览器运行: http://localhost")])])])])])}),[],!1,null,null,null);t.default=i.exports}}]);